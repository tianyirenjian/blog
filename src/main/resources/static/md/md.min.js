var Editor=function(){"use strict";function t(t,e){function n(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var e={defaultClassNamePrefix:"oh-md",defaultParams:{counter:!0,autosave:10,wordwrap:{paramVisible:!0,active:!0},doubleReturn:{modificatorKey:"shiftKey",active:!1}},defaultTheme:"oh-md-theme-default",defaultClasses:{container:["oh-md"],area:["oh-md-area"],controls:["oh-md-controls"],params:["oh-md-params"]},defaultControls:[{control:"bold",hotkey:{default:{modificator:"ctrlKey",key:"b"},mac:{modificator:"metaKey",key:"b"}}},{control:"italic",hotkey:{default:{modificator:"ctrlKey",key:"i"},mac:{modificator:"metaKey",key:"i"}}},{control:"heading",hotkey:{default:{modificator:"ctrlKey",key:"h"},mac:{modificator:"metaKey",key:"h"}}},{control:"strike",hotkey:{default:{modificator:"ctrlKey",key:"d"},mac:{modificator:"metaKey",key:"d"}}},{control:"separator"},{control:"ordered_list",hotkey:{default:{modificator:"ctrlKey",key:"o"},mac:{modificator:"metaKey",key:"o"}}},{control:"unordered_list",hotkey:{default:{modificator:"ctrlKey",key:"u"},mac:{modificator:"metaKey",key:"u"}}},{control:"separator"},{control:"quote",hotkey:{default:{modificator:"ctrlKey",key:"'"},mac:{modificator:"metaKey",key:"'"}}},{control:"code",hotkey:{default:{modificator:"ctrlKey",key:"k"},mac:{modificator:"metaKey",key:"k"}}},{control:"link",hotkey:{default:{modificator:"ctrlKey",key:"l"},mac:{modificator:"metaKey",key:"l"}}},{control:"image",hotkey:{default:{modificator:"ctrlKey",key:"g"},mac:{modificator:"metaKey",key:"g"}}},{control:"separator"},{control:"preview",hotkey:{default:{modificator:"ctrlKey",key:"j"},mac:{modificator:"metaKey",key:"j"}}},{control:"fullscreen",hotkey:{default:{modificator:"ctrlKey",key:"f"},mac:{modificator:"metaKey",key:"f"}}}],defaultLayout:["controls","area","params"]},n=function(){return window.navigator.platform.toLowerCase().includes("mac")?"mac":"default"},i={createElement:function(t,e,n){void 0===e&&(e=[""]),void 0===n&&(n={});var i,r=document.createElement(t);return(i=r.classList).add.apply(i,e),Object.keys(n).forEach(function(t){return r[t]=n[t]}),r},capitalize:function(t){return t[0].toUpperCase()+t.slice(1,t.length)},debounce:function(t,e){var n;return function(){for(var i=this,r=[],s=0;s<arguments.length;s++)r[s]=arguments[s];var a=function(){return t.apply.apply(t,[i].concat(r))};window.clearTimeout(n),n=window.setTimeout(a,e)}},detectOs:n,getNormalizedKey:function(t){return{metaKey:{mac:"⌘",default:"Meta"}[n()],altKey:"Alt",ctrlKey:"Ctrl",shiftKey:"Shift"}[t]},log:function(t,e){void 0===e&&(e="warn");for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];console[e]("[OH-MD]: "+t+"\n"+n)}},r=function(){function t(t){this.area=t}return t.prototype.insertSimpleElement=function(t){var e,n=this.area.selection,i=n.slice,r=n.value,s=i.start,a=i.end,o=t[0],l=t[1],c=r.slice(s,a),h=c.slice(o.length,l?-l.length:void 0),u=r.slice(s-o.length,a+(l?l.length:0)),p=!(o&&u.slice(0,o.length)!==o||l&&u.slice(-l.length)!==l),d={start:null,end:null},f={start:null,end:null};!(o&&c.slice(0,o.length)!==o||l&&c.slice(-l.length)!==l)?(e=h,d={start:s,end:a},f={start:s,end:h.length+s}):p?(e=c,d={start:s-o.length,end:a+(l?l.length:0)},f={start:s-o.length,end:a-(l?l.length:0)}):(e=[o,c,l].join(""),d={start:s,end:a},f={start:s+o.length,end:s+o.length+c.length}),this.area.selection={value:e,slice:d,focus:f}},t}(),s=function(t,e){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},a=function(){return(a=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++){e=arguments[n];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t}).apply(this,arguments)},o=function(){function t(t){this.handler=t,this.button=null}return t.generateElement=function(t,n){var r=i.createElement,s=i.capitalize,a=i.getNormalizedKey,o=e.defaultClasses.controls[0],l=s(t.split("_").join(" ")),c=[];n&&n.modificator&&c.push(a(n.modificator),n.key.toUpperCase());var h=c.length?" ("+c.join(" + ")+")":"",u=r("button",[o+"--button",o+"--button__"+t.toLowerCase()],{title:l+h});return u.innerHTML=l,u},t.prototype.init=function(){var n=this,i=this.handler.settings,r=i.control,s=i.hotkeyCurrent,a=i.cantBeDisabled,o=e.defaultClasses.controls[0]+"--button__forced";return this.button=t.generateElement(r,s),a&&this.button.classList.add(o),this.button.addEventListener("click",function(t){t.preventDefault(),n.handler.callback()}),this.button},t}(),l=function(e){function n(t,n,i){var r=e.call(this,i)||this;return r.controlContainer=t,r.settings=n,r.area=i,r.button=null,r}return t(n,e),n.prototype.insertTagInto=function(){this.area.disabled||e.prototype.insertSimpleElement.call(this,n.mdTag)},n.prototype.init=function(){var t={settings:this.settings,callback:this.insertTagInto.bind(this)};this.button=new o(t).init(),this.area.addHandler(t),this.controlContainer.appendChild(this.button)},n.mdTag=["**","**"],n}(r),c=function(e){function n(t,n,i){var r=e.call(this,i)||this;return r.controlContainer=t,r.settings=n,r.area=i,r.button=null,r}return t(n,e),n.prototype.insertTagInto=function(){this.area.disabled||e.prototype.insertSimpleElement.call(this,n.mdTag)},n.prototype.init=function(){var t={settings:this.settings,callback:this.insertTagInto.bind(this)};this.button=new o(t).init(),this.area.addHandler(t),this.controlContainer.appendChild(this.button)},n.mdTag=["_","_"],n}(r),h=function(){function t(t,e,n){this.controlContainer=t,this.settings=e||{},this.area=n}return t.prototype.init=function(){var t=e.defaultClasses.controls[0],n=(0,i.createElement)("div",[t+"--separator"]);this.controlContainer.appendChild(n)},t}(),u=function(e){function n(t,n,i){var r=e.call(this,i)||this;return r.controlContainer=t,r.settings=n,r.area=i,r.button=null,r}return t(n,e),n.prototype.insertTagInto=function(){this.area.disabled||e.prototype.insertSimpleElement.call(this,n.mdTag)},n.prototype.init=function(){var t={settings:this.settings,callback:this.insertTagInto.bind(this)};this.button=new o(t).init(),this.area.addHandler(t),this.controlContainer.appendChild(this.button)},n.mdTag=["~~","~~"],n}(r),p=function(e){function n(t,n,i){var r=e.call(this,i)||this;return r.controlContainer=t,r.settings=n,r.area=i,r.button=null,r}return t(n,e),n.prototype.insertTagInto=function(){if(!this.area.disabled){var t=this.area.hasEndOfLine()?n.fullMdTag:n.mdTag;e.prototype.insertSimpleElement.call(this,t)}},n.prototype.init=function(){var t={settings:this.settings,callback:this.insertTagInto.bind(this)};this.button=new o(t).init(),this.area.addHandler(t),this.controlContainer.appendChild(this.button)},n.mdTag=["`","`"],n.fullMdTag=["```\n","\n```"],n}(r),d=function(e){function n(t,n,i){var r=e.call(this,i)||this;return r.controlContainer=t,r.settings=n,r.area=i,r.button=null,r}return t(n,e),n.prototype.insertTagInto=function(){if(!this.area.disabled){var t=this.area.selection,e=t.value,r=t.slice,s=t.selectedValue,a=r.start,o=r.end,l=i.capitalize,c=n.mdTag[0],h=s.length,u=e.slice(a,o),p=e.slice(a-c.length,o),d=l(this.settings.control.split("_").join(" ")),f=new RegExp(/^\d. /),g=p.split("\n").filter(function(t){return""!==t}),m=!1,b=0;if(g.forEach(function(t){""!==t&&t.match(f)&&(b+=1)}),g.length===b&&(m=!0),h)if(m){var y=0,v=p.split("\n").map(function(t){return""!==t&&t.match(f)?(y+=1,t.replace(f,"")):t}).join("\n"),k=p.slice(0,c.length)!==c,x={start:a-c.length,end:o},w={start:k?a:a-c.length,end:o-y*c.length-y*" ".length};this.area.selection={value:v,slice:x,focus:w}}else{var _=0,C=e.slice(a-2,a).split("").reverse(),T=function(){for(var t=2,e=0;C.length&&"\n"===C[e];e+=1)t-=1;return t}(),E="\n".repeat(T),L=e.slice(o,o+2).split(""),S=function(){for(var t=2,e=0;L.length&&"\n"===L[e];e+=1)t-=1;return t}(),P="\n".repeat(S),$=u.split("\n").map(function(t){return""!==t?(_+=1,c.replace("$",String(_))+" "+t):t}).join("\n"),O=(c[0].length+" ".length)*_,v=E+$+P,R={start:a,end:o},A={start:a+E.length,end:o+P.length+O+_};this.area.selection={value:v,slice:R,focus:A}}else{var z=e.slice(a-2,a).split("").reverse(),T=function(){for(var t=2,e=0;z.length&&"\n"===z[e];e+=1)t-=1;return t}(),E="\n".repeat(T),j=e.slice(o,o+2).split(""),S=function(){for(var t=2,e=0;j.length&&"\n"===j[e];e+=1)t-=1;return t}(),P="\n".repeat(S),v=E+c.replace("$","1")+" "+d+P,K={start:a,end:o},I={start:a+E.length+c.length+" ".length,end:a+E.length+c.length+" ".length+d.length};this.area.selection={value:v,slice:K,focus:I}}}},n.prototype.init=function(){var t={settings:this.settings,callback:this.insertTagInto.bind(this)};this.button=new o(t).init(),this.area.addHandler(t),this.controlContainer.appendChild(this.button)},n.mdTag=["$.",null],n}(r),f=function(e){function n(t,n,i){var r=e.call(this,i)||this;return r.controlContainer=t,r.settings=n,r.area=i,r.button=null,r}return t(n,e),n.prototype.insertTagInto=function(){if(!this.area.disabled){var t=this.area.selection,e=t.value,r=t.slice,s=r.start,a=r.end,o=i.capitalize,l=n.mdTag[0],c=a-s,h=e.slice(s,a),u=e.slice(s-l.length,a),p=u.includes(l),d=o(this.settings.control.split("_").join(" "));if(c)if(p){var f=0;u.split("").forEach(function(t,e){t===l&&" "===u[e+1]&&(f+=1)});var g=new RegExp(/- /g),m=u.replace(g,""),b={start:s-l.length,end:a},y={start:u.slice(0,l.length)!==l?s:s-l.length,end:a-f*l.length-f*" ".length};this.area.selection={value:m,slice:b,focus:y}}else{var v=0,k=e.slice(s-2,s).split("").reverse(),x=function(){for(var t=2,e=0;k.length&&"\n"===k[e];e+=1)t-=1;return t}(),w="\n".repeat(x),_=e.slice(a,a+2).split(""),C=function(){for(var t=2,e=0;_.length&&"\n"===_[e];e+=1)t-=1;return t}(),T="\n".repeat(C),m=w+h.split("\n").map(function(t){return""!==t?(v+=1,l+" "+t):t}).join("\n")+T,E={start:s,end:a},L={start:s+w.length,end:a+T.length+v+v*" ".length};this.area.selection={value:m,slice:E,focus:L}}else{var S=e.slice(s-2,s).split("").reverse(),x=function(){for(var t=2,e=0;S.length&&"\n"===S[e];e+=1)t-=1;return t}(),w="\n".repeat(x),P=e.slice(a,a+2).split(""),C=function(){for(var t=2,e=0;P.length&&"\n"===P[e];e+=1)t-=1;return t}(),T="\n".repeat(C),m=w+l+" "+d+T,$={start:s,end:a},O={start:s+w.length+l.length+" ".length,end:s+w.length+l.length+" ".length+d.length};this.area.selection={value:m,slice:$,focus:O}}}},n.prototype.init=function(){var t={settings:this.settings,callback:this.insertTagInto.bind(this)};this.button=new o(t).init(),this.area.addHandler(t),this.controlContainer.appendChild(this.button)},n.mdTag=["-",""],n}(r),g=function(e){function n(t,n,i){var r=e.call(this,i)||this;return r.controlContainer=t,r.settings=n,r.area=i,r.button=null,r}return t(n,e),n.prototype.insertTagInto=function(){if(!this.area.disabled){var t=this.area.selection,e=t.value,r=t.slice,s=t.selectedValue,a=r.start,o=r.end,l=i.capitalize,c=n.mdTag[0],h=s.length,u=e.slice(a,o),p=e.slice(a-c.length,o),d=p.includes(c),f=l(this.settings.control.split("_").join(""));if(h)if(d){var g=0;p.split("").forEach(function(t,e){t===c&&" "===p[e+1]&&(g+=1)});var m=new RegExp(/> /g),b=p.slice(0,c.length)!==c,y=p.replace(m,""),v={start:a-c.length,end:o},k={start:b?a:a-c.length,end:o-g*c.length-g*" ".length};this.area.selection={value:y,slice:v,focus:k}}else{var x=0,w=e.slice(a-2,a).split("").reverse(),_=function(){for(var t=2,e=0;w.length&&"\n"===w[e];e+=1)t-=1;return t}(),C="\n".repeat(_),T=e.slice(o,o+2).split(""),E=function(){for(var t=2,e=0;T.length&&"\n"===T[e];e+=1)t-=1;return t}(),L="\n".repeat(E),y=C+u.split("\n").map(function(t){return""!==t?(x+=1,c+" "+t):t}).join("\n")+L,S={start:a,end:o},P={start:a+C.length,end:o+L.length+x+x*" ".length};this.area.selection={value:y,slice:S,focus:P}}else{var $=e.slice(a-2,a).split("").reverse(),_=function(){for(var t=2,e=0;$.length&&"\n"===$[e];e+=1)t-=1;return t}(),C="\n".repeat(_),O=e.slice(o,o+2).split(""),E=function(){for(var t=2,e=0;O.length&&"\n"===O[e];e+=1)t-=1;return t}(),L="\n".repeat(E),y=C+c+" "+f+L,R={start:a,end:o},A={start:a+C.length+c.length+" ".length,end:a+C.length+c.length+" ".length+f.length};this.area.selection={value:y,slice:R,focus:A}}}},n.prototype.init=function(){var t={settings:this.settings,callback:this.insertTagInto.bind(this)};this.button=new o(t).init(),this.area.addHandler(t),this.controlContainer.appendChild(this.button)},n.mdTag=[">",null],n}(r),m=function(e){function n(t,n,i){var r=e.call(this,i)||this;return r.controlContainer=t,r.settings=n,r.area=i,r.button=null,r}return t(n,e),n.getNextQuantity=function(t){return t+1<=n.mdTagMaxLength?t+1:1},n.setTagPrefix=function(t,e){var i=t.slice(0,e);return i.length+1<=n.mdTagMaxLength?n.mdTag[0].repeat(i.length+1)+t.slice(e):n.mdTag[0]+t.slice(e)},n.getTagsQuantity=function(t){for(var e=0,i=t.split(""),r=0;i.length>r&&i[r]===n.mdTag[0];r+=1)e+=1;return" "===t[e]?e:0},n.prototype.getPrefixQty=function(t){for(var e=n.mdTag[0],i=t-" ".length,r=0,s=this.area.selection.value,a=0;t>a;a+=1){var o=s.slice(i-a,i).split("");if(o.length){if(!o.every(function(t){return t===e}))break;r+=1}}return r},n.prototype.insertTagInto=function(){if(!this.area.disabled){var t=this.area.selection,e=t.value,r=t.slice,s=t.selectedValue,a=r.start,o=r.end,l=n.mdTag[0],c=i.capitalize(this.settings.control.split("_").join("")),h=s.length,u=s,p=u.startsWith(l),d=e.slice(a-" ".length-l.length,o).startsWith(l);if(h){if(p){var f=n.getTagsQuantity(u),g=n.getNextQuantity(f),m=n.setTagPrefix(u,f),b={start:a,end:o},y={start:a+g+" ".length,end:o-f+g};return void(this.area.selection={value:m,slice:b,focus:y})}if(d){var v=this.getPrefixQty(a),g=n.getNextQuantity(v),k=e.slice(a-" ".length-v,o),x=n.setTagPrefix(k,v),w={start:a-" ".length-v,end:o},_={start:a-v+g,end:o-v+g};return void(this.area.selection={value:x,slice:w,focus:_})}var C=e.slice(a-1,a).split("").reverse(),T=function(){for(var t=1,e=0;C.length&&"\n"===C[e];e+=1)t-=1;return t}(),E="\n".repeat(T),L=e.slice(o,o+2).split(""),S=function(){for(var t=2,e=0;L.length&&"\n"===L[e];e+=1)t-=1;return t}(),P=E+l+" "+u+(z="\n".repeat(S)),$={start:a,end:o},O={start:a+E.length+l.length+" ".length,end:a+E.length+l.length+" ".length+u.length};this.area.selection={value:P,slice:$,focus:O}}else{var R=e.slice(a-1,a).split("").reverse(),T=function(){for(var t=1,e=0;R.length&&"\n"===R[e];e+=1)t-=1;return t}(),E="\n".repeat(T),A=e.slice(o,o+2).split(""),S=function(){for(var t=2,e=0;A.length&&"\n"===A[e];e+=1)t-=1;return t}(),z="\n".repeat(S),P=E+l+" "+c+z,j={start:a,end:o},K={start:a+E.length+l.length+" ".length,end:a+E.length+l.length+" ".length+c.length};this.area.selection={value:P,slice:j,focus:K}}}},n.prototype.init=function(){var t={settings:this.settings,callback:this.insertTagInto.bind(this)};this.button=new o(t).init(),this.area.addHandler(t),this.controlContainer.appendChild(this.button)},n.mdTag=["#",null],n.mdTagMaxLength=6,n}(r),b=function(n){function i(t,e,i){var r=n.call(this,i)||this;return r.controlContainer=t,r.settings=e,r.area=i,r.button=null,r}return t(i,n),i.prototype.toggleFullscreen=function(){var t=this,n=this.area.enabledFullscreen,i=e.defaultClasses.controls[0],r=[i+"--button__fullscreen__active",i+"--button__active"];n?(r.forEach(function(e){t.button.classList.remove(e)}),this.area.enabledFullscreen=!1):(r.forEach(function(e){t.button.classList.add(e)}),this.area.enabledFullscreen=!0)},i.prototype.init=function(){var t={settings:a({},this.settings,{cantBeDisabled:!0}),callback:this.toggleFullscreen.bind(this)};this.button=new o(t).init(),this.area.addHandler(t),this.controlContainer.appendChild(this.button)},i}(r),y=function(n){function i(t,e,i){var r=n.call(this,i)||this;return r.controlContainer=t,r.settings=e,r.area=i,r.button=null,r}return t(i,n),i.prototype.togglePreview=function(){var t=this,n=this.area.enabledPreview,i=e.defaultClasses.controls[0],r=[i+"--button__preview__active",i+"--button__active"];n?(r.forEach(function(e){t.button.classList.remove(e)}),this.area.enabledPreview=!1):(r.forEach(function(e){t.button.classList.add(e)}),this.area.enabledPreview=!0)},i.prototype.init=function(){var t={settings:a({},this.settings,{cantBeDisabled:!0}),callback:this.togglePreview.bind(this)};this.button=new o(t).init(),this.area.addHandler(t),this.controlContainer.appendChild(this.button)},i}(r),v=function(){function t(t,e,n,i,r){this.settings=e,this.container=t.parentElement,this.submit=n,this.cancel=i,this.done=r,this.form=null,this.btnSubmit=null,this.btnCancel=null,this.keyHandler=this.keyHandler.bind(this),this.removePopup=this.removePopup.bind(this),this.submitPopup=this.submitPopup.bind(this)}return t.generateFormItem=function(n){var r=i.createElement,s=e.defaultClasses.area[0]+"--popup-item",a=t.prefixPopupId,o=""+a+n.id,l=r("div",[s]),c=r("label",[s+"-label"],{for:""+a+n.id}),h=r("input",[s+"-input"],{id:o,type:n.type,value:n.value});return c.innerText=n.title,l.appendChild(c),l.appendChild(h),l},t.prototype.collectData=function(){var e=this,n=[],i=t.prefixPopupId;return this.settings.forEach(function(t){var r="#"+i+t.id,s=e.form.querySelector(r).value;n.push(a({},t,{value:s}))}),n},t.prototype.generateControls=function(){var t=i.createElement,n=e.defaultClasses.area[0]+"--popup-controls",r=t("div",[n]);return this.btnSubmit=t("button",[n+"-button",n+"-button__submit"]),this.btnCancel=t("button",[n+"-button",n+"-button__cancel"]),this.btnCancel.innerText="Cancel",this.btnSubmit.innerText="OK",this.btnCancel.addEventListener("click",this.removePopup),this.btnSubmit.addEventListener("click",this.submitPopup),r.appendChild(this.btnCancel),r.appendChild(this.btnSubmit),r},t.prototype.generateForm=function(){var n=this,r=i.createElement,s=e.defaultClasses.area;this.form=r("div",[s+"--popup"]),t.isFormExists=!0,this.settings.forEach(function(e){var i=t.generateFormItem(e);n.form.appendChild(i)}),this.form.appendChild(this.generateControls()),this.container.appendChild(this.form),this.form.querySelector("input").focus(),document.addEventListener("keydown",this.keyHandler)},t.prototype.keyHandler=function(t){27===t.keyCode&&this.removePopup(t),13===t.keyCode&&this.submitPopup(t)},t.prototype.removePopup=function(e){e.preventDefault(),document.removeEventListener("keydown",this.keyHandler),this.btnCancel.removeEventListener("click",this.removePopup),this.btnSubmit.removeEventListener("click",this.submitPopup),this.container.removeChild(this.form),this.keyHandler=null,this.form=null,t.isFormExists=!1,this.done(),this.cancel()},t.prototype.submitPopup=function(t){t.preventDefault();var e=this.collectData();this.done(),this.submit(e),this.removePopup(t)},t.prototype.init=function(){return t.isFormExists?null:(this.generateForm(),this)},t.prefixPopupId="popup-item-",t.isFormExists=!1,t}(),k={Control:r,Separator:h,Bold:l,Italic:c,Strike:u,Code:p,Ordered_list:d,Unordered_list:f,Quote:g,Heading:m,Fullscreen:b,Preview:y,Image:function(n){function i(t,e,i){var r=n.call(this,i)||this;return r.controlContainer=t,r.settings=e,r.area=i,r.button=null,r}return t(i,n),i.prototype.onSubmit=function(t){var e=this.area.selection.slice,n=i.mdTag[0];t.forEach(function(t){return n=n.replace(t.id,t.value)}),this.area.selection={value:n,slice:e,focus:{start:e.start,end:e.start+n.length}}},i.prototype.onCancel=function(){},i.prototype.onDone=function(){var t=e.defaultClasses.controls[0]+"--button__active";this.button.classList.remove(t)},i.prototype.handle=function(){if(!this.area.disabled){var t=this.area.selection.selectedValue,n=e.defaultClasses.controls[0]+"--button__active",r=[{value:t,type:"text",id:i.mdTagText,title:"Image title"},{value:"",type:"text",id:i.mdTagLink,title:"Image URL"}],s=new v(this.area.areaContainer,r,this.onSubmit.bind(this),this.onCancel.bind(this),this.onDone.bind(this)).init();return s&&this.button.classList.add(n),s}},i.prototype.init=function(){var t={settings:this.settings,callback:this.handle.bind(this)};this.button=new o(t).init(),this.area.addHandler(t),this.controlContainer.appendChild(this.button)},i.mdTagText="__text__",i.mdTagLink="__href__",i.mdTag=["!["+i.mdTagText+"]("+i.mdTagLink+")",null],i}(r),Link:function(n){function i(t,e,i){var r=n.call(this,i)||this;return r.controlContainer=t,r.settings=e,r.area=i,r.button=null,r}return t(i,n),i.prototype.onSubmit=function(t){var e=this.area.selection.slice,n=i.mdTag[0];t.forEach(function(t){return n=n.replace(t.id,t.value)}),this.area.selection={value:n,slice:e,focus:{start:e.start,end:e.start+n.length}}},i.prototype.onDone=function(){var t=e.defaultClasses.controls[0]+"--button__active";this.button.classList.remove(t)},i.prototype.onCancel=function(){},i.prototype.handle=function(){if(!this.area.disabled){var t=this.area.selection.selectedValue,n=e.defaultClasses.controls[0]+"--button__active",r=[{value:t,type:"text",id:i.mdTagText,title:"Insert text"},{value:"",type:"text",id:i.mdTagLink,title:"Insert URL"}],s=new v(this.area.areaContainer,r,this.onSubmit.bind(this),this.onCancel.bind(this),this.onDone.bind(this)).init();return s&&this.button.classList.add(n),s}},i.prototype.init=function(){var t={settings:this.settings,callback:this.handle.bind(this)};this.button=new o(t).init(),this.area.addHandler(t),this.controlContainer.appendChild(this.button)},i.mdTagText="__text__",i.mdTagLink="__href__",i.mdTag=["["+i.mdTagText+"]("+i.mdTagLink+")",null],i}(r)},x={Autosave:function(){function t(t,e,n){this.element=null,this.area=t,this.container=e,this.settings=n}return t.prototype.getTextareaHash=function(){var e=window.document.URL,n=this.settings.id;return""+e+t.separator+n},t.prototype.fillTextArea=function(){var t=this.getTextareaHash();this.area.selection={focus:{start:0,end:0},slice:{start:0,end:0},value:window.localStorage[t]||""}},t.prototype.saveText=function(){var t=this,n=e.defaultClasses.params[0],i=this.area.selection.value,r=this.getTextareaHash(),s=n+"--autosave__saved";this.element.classList.add(s),window.localStorage[r]=i,setTimeout(function(){t.element.classList.remove(s)},2e3)},t.prototype.init=function(){var t=this,n=e.defaultClasses,r=i.createElement,s=i.log,a=n.params[0],o=this.settings.autosave,l=this.area.areaElement.name||this.area.areaElement.id||null;l||s("Id or name is not exists"),o&&l&&(this.element=r("p",[a+"--autosave"]),this.element.innerHTML="Saved",this.container.appendChild(this.element),this.settings.id=l,this.fillTextArea(),setInterval(function(){t.saveText()},1e3*o))},t.separator="|||||",t}(),Counter:function(){function t(t,e,n){this.element=null,this.area=t,this.container=e,this.settings=n}return t.prototype.setHandlers=function(){var t=this;document.addEventListener("DOMContentLoaded",function(){t.area.areaElement.addEventListener("input",t.counterUpdate.bind(t)),t.area.areaElement.addEventListener("keyup",t.counterUpdate.bind(t)),t.counterUpdate()})},t.prototype.counterUpdate=function(){var t=this;window.setTimeout(function(){t.element.innerHTML=String(t.area.text.length)},0)},t.prototype.init=function(){var t=e.defaultClasses.params[0];this.settings.counter&&(this.element=i.createElement("p",[t+"--counter"]),this.container.appendChild(this.element),this.setHandlers())},t}(),Wordwrap:function(){function t(t,e,n){this.area=t,this.container=e,this.settings=n,this.element=null,this.wordwrapStatus=null}return t.prototype.setWordwrapStatus=function(){var t=e.defaultClasses.area[0]+"--text--wordwrap__off",n=e.defaultClasses.params[0]+"--wordwrap__off";this.wordwrapStatus=!this.wordwrapStatus,this.wordwrapStatus?(this.area.areaElement.classList.add(t),this.element.classList.add(n)):(this.area.areaElement.classList.remove(t),this.element.classList.remove(n))},t.prototype.init=function(){var t=i.createElement,n=e.defaultClasses.params[0],r=this.settings.wordwrap,s=r.paramVisible,a=r.active;this.wordwrapStatus=a,s&&(this.element=t("a",[n+"--wordwrap"],{title:"Word wrap"}),this.setWordwrapStatus(),this.element.addEventListener("click",this.setWordwrapStatus.bind(this)),this.container.appendChild(this.element))},t}(),DoubleReturn:function(){function t(t,e,n){this.area=t,this.container=e,this.settings=n}return t.prototype.keyHandler=function(t){var e=this.settings.doubleReturn.modificatorKey;if(13===t.keyCode){var n=this.area.selection.slice,i=t[e]?1:2,r="\n".repeat(i);t.preventDefault(),this.area.selection={slice:n,focus:{start:n.start+i,end:n.end+i},value:r}}},t.prototype.setHandlers=function(){var t=this;document.addEventListener("DOMContentLoaded",function(){t.area.areaElement.addEventListener("keydown",t.keyHandler.bind(t))})},t.prototype.init=function(){this.settings.doubleReturn.active&&this.setHandlers()},t}()},w="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},_=function(t,e){return e={exports:{}},t(e,e.exports),e.exports}(function(t,e){!function(e){function n(t){this.tokens=[],this.tokens.links=Object.create(null),this.options=t||y.defaults,this.rules=v.normal,this.options.pedantic?this.rules=v.pedantic:this.options.gfm&&(this.options.tables?this.rules=v.tables:this.rules=v.gfm)}function i(t,e){if(this.options=e||y.defaults,this.links=t,this.rules=k.normal,this.renderer=this.options.renderer||new r,this.renderer.options=this.options,!this.links)throw new Error("Tokens array requires a `links` property.");this.options.pedantic?this.rules=k.pedantic:this.options.gfm&&(this.options.breaks?this.rules=k.breaks:this.rules=k.gfm)}function r(t){this.options=t||y.defaults}function s(){}function a(t){this.tokens=[],this.token=null,this.options=t||y.defaults,this.options.renderer=this.options.renderer||new r,this.renderer=this.options.renderer,this.renderer.options=this.options,this.slugger=new o}function o(){this.seen={}}function l(t,e){if(e){if(l.escapeTest.test(t))return t.replace(l.escapeReplace,function(t){return l.replacements[t]})}else if(l.escapeTestNoEncode.test(t))return t.replace(l.escapeReplaceNoEncode,function(t){return l.replacements[t]});return t}function c(t){return t.replace(/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/gi,function(t,e){return e=e.toLowerCase(),"colon"===e?":":"#"===e.charAt(0)?"x"===e.charAt(1)?String.fromCharCode(parseInt(e.substring(2),16)):String.fromCharCode(+e.substring(1)):""})}function h(t,e){return t=t.source||t,e=e||"",{replace:function(e,n){return n=n.source||n,n=n.replace(/(^|[^\[])\^/g,"$1"),t=t.replace(e,n),this},getRegex:function(){return new RegExp(t,e)}}}function u(t,e,n){if(t){try{var i=decodeURIComponent(c(n)).replace(/[^\w:]/g,"").toLowerCase()}catch(t){return null}if(0===i.indexOf("javascript:")||0===i.indexOf("vbscript:")||0===i.indexOf("data:"))return null}e&&!w.test(n)&&(n=p(e,n));try{n=encodeURI(n).replace(/%25/g,"%")}catch(t){return null}return n}function p(t,e){return x[" "+t]||(/^[^:]+:\/*[^\/]*$/.test(t)?x[" "+t]=t+"/":x[" "+t]=m(t,"/",!0)),t=x[" "+t],"//"===e.slice(0,2)?t.replace(/:[\s\S]*/,":")+e:"/"===e.charAt(0)?t.replace(/(:\/*[^\/]*)[\s\S]*/,"$1")+e:t+e}function d(){}function f(t){for(var e,n,i=1;i<arguments.length;i++){e=arguments[i];for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}return t}function g(t,e){var n=t.replace(/\|/g,function(t,e,n){for(var i=!1,r=e;--r>=0&&"\\"===n[r];)i=!i;return i?"|":" |"}).split(/ \|/),i=0;if(n.length>e)n.splice(e);else for(;n.length<e;)n.push("");for(;i<n.length;i++)n[i]=n[i].trim().replace(/\\\|/g,"|");return n}function m(t,e,n){if(0===t.length)return"";for(var i=0;i<t.length;){var r=t.charAt(t.length-i-1);if(r!==e||n){if(r===e||!n)break;i++}else i++}return t.substr(0,t.length-i)}function b(t,e){if(-1===t.indexOf(e[1]))return-1;for(var n=0,i=0;i<t.length;i++)if("\\"===t[i])i++;else if(t[i]===e[0])n++;else if(t[i]===e[1]&&--n<0)return i;return-1}function y(t,e,i){if(void 0===t||null===t)throw new Error("marked(): input parameter is undefined or null");if("string"!=typeof t)throw new Error("marked(): input parameter is of type "+Object.prototype.toString.call(t)+", string expected");if(i||"function"==typeof e){i||(i=e,e=null);var r,s,o=(e=f({},y.defaults,e||{})).highlight,c=0;try{r=n.lex(t,e)}catch(t){return i(t)}s=r.length;var h=function(t){if(t)return e.highlight=o,i(t);var n;try{n=a.parse(r,e)}catch(e){t=e}return e.highlight=o,t?i(t):i(null,n)};if(!o||o.length<3)return h();if(delete e.highlight,!s)return h();for(;c<r.length;c++)!function(t){"code"!==t.type?--s||h():o(t.text,t.lang,function(e,n){return e?h(e):null==n||n===t.text?--s||h():(t.text=n,t.escaped=!0,void(--s||h()))})}(r[c])}else try{return e&&(e=f({},y.defaults,e)),a.parse(n.lex(t,e),e)}catch(t){if(t.message+="\nPlease report this to https://github.com/markedjs/marked.",(e||y.defaults).silent)return"<p>An error occurred:</p><pre>"+l(t.message+"",!0)+"</pre>";throw t}}var v={newline:/^\n+/,code:/^( {4}[^\n]+\n*)+/,fences:d,hr:/^ {0,3}((?:- *){3,}|(?:_ *){3,}|(?:\* *){3,})(?:\n+|$)/,heading:/^ *(#{1,6}) *([^\n]+?) *(?:#+ *)?(?:\n+|$)/,nptable:d,blockquote:/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/,list:/^( {0,3})(bull) [\s\S]+?(?:hr|def|\n{2,}(?! )(?!\1bull )\n*|\s*$)/,html:"^ {0,3}(?:<(script|pre|style)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?\\?>\\n*|<![A-Z][\\s\\S]*?>\\n*|<!\\[CDATA\\[[\\s\\S]*?\\]\\]>\\n*|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:\\n{2,}|$)|<(?!script|pre|style)([a-z][\\w-]*)(?:attribute)*? */?>(?=\\h*\\n)[\\s\\S]*?(?:\\n{2,}|$)|</(?!script|pre|style)[a-z][\\w-]*\\s*>(?=\\h*\\n)[\\s\\S]*?(?:\\n{2,}|$))",def:/^ {0,3}\[(label)\]: *\n? *<?([^\s>]+)>?(?:(?: +\n? *| *\n *)(title))? *(?:\n+|$)/,table:d,lheading:/^([^\n]+)\n *(=|-){2,} *(?:\n+|$)/,paragraph:/^([^\n]+(?:\n(?!hr|heading|lheading| {0,3}>|<\/?(?:tag)(?: +|\n|\/?>)|<(?:script|pre|style|!--))[^\n]+)*)/,text:/^[^\n]+/};v._label=/(?!\s*\])(?:\\[\[\]]|[^\[\]])+/,v._title=/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/,v.def=h(v.def).replace("label",v._label).replace("title",v._title).getRegex(),v.bullet=/(?:[*+-]|\d{1,9}\.)/,v.item=/^( *)(bull) ?[^\n]*(?:\n(?!\1bull ?)[^\n]*)*/,v.item=h(v.item,"gm").replace(/bull/g,v.bullet).getRegex(),v.list=h(v.list).replace(/bull/g,v.bullet).replace("hr","\\n+(?=\\1?(?:(?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$))").replace("def","\\n+(?="+v.def.source+")").getRegex(),v._tag="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|section|source|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",v._comment=/<!--(?!-?>)[\s\S]*?-->/,v.html=h(v.html,"i").replace("comment",v._comment).replace("tag",v._tag).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),v.paragraph=h(v.paragraph).replace("hr",v.hr).replace("heading",v.heading).replace("lheading",v.lheading).replace("tag",v._tag).getRegex(),v.blockquote=h(v.blockquote).replace("paragraph",v.paragraph).getRegex(),v.normal=f({},v),v.gfm=f({},v.normal,{fences:/^ {0,3}(`{3,}|~{3,})([^`\n]*)\n(?:|([\s\S]*?)\n)(?: {0,3}\1[~`]* *(?:\n+|$)|$)/,paragraph:/^/,heading:/^ *(#{1,6}) +([^\n]+?) *#* *(?:\n+|$)/}),v.gfm.paragraph=h(v.paragraph).replace("(?!","(?!"+v.gfm.fences.source.replace("\\1","\\2")+"|"+v.list.source.replace("\\1","\\3")+"|").getRegex(),v.tables=f({},v.gfm,{nptable:/^ *([^|\n ].*\|.*)\n *([-:]+ *\|[-| :]*)(?:\n((?:.*[^>\n ].*(?:\n|$))*)\n*|$)/,table:/^ *\|(.+)\n *\|?( *[-:]+[-| :]*)(?:\n((?: *[^>\n ].*(?:\n|$))*)\n*|$)/}),v.pedantic=f({},v.normal,{html:h("^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:\"[^\"]*\"|'[^']*'|\\s[^'\"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))").replace("comment",v._comment).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/}),n.rules=v,n.lex=function(t,e){return new n(e).lex(t)},n.prototype.lex=function(t){return t=t.replace(/\r\n|\r/g,"\n").replace(/\t/g,"    ").replace(/\u00a0/g," ").replace(/\u2424/g,"\n"),this.token(t,!0)},n.prototype.token=function(t,e){t=t.replace(/^ +$/gm,"");for(var n,i,r,s,a,o,l,c,h,u,p,d,f,b,y,k;t;)if((r=this.rules.newline.exec(t))&&(t=t.substring(r[0].length),r[0].length>1&&this.tokens.push({type:"space"})),r=this.rules.code.exec(t))t=t.substring(r[0].length),r=r[0].replace(/^ {4}/gm,""),this.tokens.push({type:"code",text:this.options.pedantic?r:m(r,"\n")});else if(r=this.rules.fences.exec(t))t=t.substring(r[0].length),this.tokens.push({type:"code",lang:r[2]?r[2].trim():r[2],text:r[3]||""});else if(r=this.rules.heading.exec(t))t=t.substring(r[0].length),this.tokens.push({type:"heading",depth:r[1].length,text:r[2]});else if(e&&(r=this.rules.nptable.exec(t))&&(o={type:"table",header:g(r[1].replace(/^ *| *\| *$/g,"")),align:r[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:r[3]?r[3].replace(/\n$/,"").split("\n"):[]}).header.length===o.align.length){for(t=t.substring(r[0].length),p=0;p<o.align.length;p++)/^ *-+: *$/.test(o.align[p])?o.align[p]="right":/^ *:-+: *$/.test(o.align[p])?o.align[p]="center":/^ *:-+ *$/.test(o.align[p])?o.align[p]="left":o.align[p]=null;for(p=0;p<o.cells.length;p++)o.cells[p]=g(o.cells[p],o.header.length);this.tokens.push(o)}else if(r=this.rules.hr.exec(t))t=t.substring(r[0].length),this.tokens.push({type:"hr"});else if(r=this.rules.blockquote.exec(t))t=t.substring(r[0].length),this.tokens.push({type:"blockquote_start"}),r=r[0].replace(/^ *> ?/gm,""),this.token(r,e),this.tokens.push({type:"blockquote_end"});else if(r=this.rules.list.exec(t)){for(t=t.substring(r[0].length),l={type:"list_start",ordered:b=(s=r[2]).length>1,start:b?+s:"",loose:!1},this.tokens.push(l),c=[],n=!1,f=(r=r[0].match(this.rules.item)).length,p=0;p<f;p++)u=(o=r[p]).length,~(o=o.replace(/^ *([*+-]|\d+\.) */,"")).indexOf("\n ")&&(u-=o.length,o=this.options.pedantic?o.replace(/^ {1,4}/gm,""):o.replace(new RegExp("^ {1,"+u+"}","gm"),"")),p!==f-1&&(a=v.bullet.exec(r[p+1])[0],(s.length>1?1===a.length:a.length>1||this.options.smartLists&&a!==s)&&(t=r.slice(p+1).join("\n")+t,p=f-1)),i=n||/\n\n(?!\s*$)/.test(o),p!==f-1&&(n="\n"===o.charAt(o.length-1),i||(i=n)),i&&(l.loose=!0),k=void 0,(y=/^\[[ xX]\] /.test(o))&&(k=" "!==o[1],o=o.replace(/^\[[ xX]\] +/,"")),h={type:"list_item_start",task:y,checked:k,loose:i},c.push(h),this.tokens.push(h),this.token(o,!1),this.tokens.push({type:"list_item_end"});if(l.loose)for(f=c.length,p=0;p<f;p++)c[p].loose=!0;this.tokens.push({type:"list_end"})}else if(r=this.rules.html.exec(t))t=t.substring(r[0].length),this.tokens.push({type:this.options.sanitize?"paragraph":"html",pre:!this.options.sanitizer&&("pre"===r[1]||"script"===r[1]||"style"===r[1]),text:r[0]});else if(e&&(r=this.rules.def.exec(t)))t=t.substring(r[0].length),r[3]&&(r[3]=r[3].substring(1,r[3].length-1)),d=r[1].toLowerCase().replace(/\s+/g," "),this.tokens.links[d]||(this.tokens.links[d]={href:r[2],title:r[3]});else if(e&&(r=this.rules.table.exec(t))&&(o={type:"table",header:g(r[1].replace(/^ *| *\| *$/g,"")),align:r[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:r[3]?r[3].replace(/(?: *\| *)?\n$/,"").split("\n"):[]}).header.length===o.align.length){for(t=t.substring(r[0].length),p=0;p<o.align.length;p++)/^ *-+: *$/.test(o.align[p])?o.align[p]="right":/^ *:-+: *$/.test(o.align[p])?o.align[p]="center":/^ *:-+ *$/.test(o.align[p])?o.align[p]="left":o.align[p]=null;for(p=0;p<o.cells.length;p++)o.cells[p]=g(o.cells[p].replace(/^ *\| *| *\| *$/g,""),o.header.length);this.tokens.push(o)}else if(r=this.rules.lheading.exec(t))t=t.substring(r[0].length),this.tokens.push({type:"heading",depth:"="===r[2]?1:2,text:r[1]});else if(e&&(r=this.rules.paragraph.exec(t)))t=t.substring(r[0].length),this.tokens.push({type:"paragraph",text:"\n"===r[1].charAt(r[1].length-1)?r[1].slice(0,-1):r[1]});else if(r=this.rules.text.exec(t))t=t.substring(r[0].length),this.tokens.push({type:"text",text:r[0]});else if(t)throw new Error("Infinite loop on byte: "+t.charCodeAt(0));return this.tokens};var k={escape:/^\\([!"#$%&'()*+,\-.\/:;<=>?@\[\]\\^_`{|}~])/,autolink:/^<(scheme:[^\s\x00-\x1f<>]*|email)>/,url:d,tag:"^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>",link:/^!?\[(label)\]\(href(?:\s+(title))?\s*\)/,reflink:/^!?\[(label)\]\[(?!\s*\])((?:\\[\[\]]?|[^\[\]\\])+)\]/,nolink:/^!?\[(?!\s*\])((?:\[[^\[\]]*\]|\\[\[\]]|[^\[\]])*)\](?:\[\])?/,strong:/^__([^\s_])__(?!_)|^\*\*([^\s*])\*\*(?!\*)|^__([^\s][\s\S]*?[^\s])__(?!_)|^\*\*([^\s][\s\S]*?[^\s])\*\*(?!\*)/,em:/^_([^\s_])_(?!_)|^\*([^\s*"<\[])\*(?!\*)|^_([^\s][\s\S]*?[^\s_])_(?!_|[^\spunctuation])|^_([^\s_][\s\S]*?[^\s])_(?!_|[^\spunctuation])|^\*([^\s"<\[][\s\S]*?[^\s*])\*(?!\*)|^\*([^\s*"<\[][\s\S]*?[^\s])\*(?!\*)/,code:/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,br:/^( {2,}|\\)\n(?!\s*$)/,del:d,text:/^(`+|[^`])[\s\S]*?(?=[\\<!\[`*]|\b_| {2,}\n|$)/};k._punctuation="!\"#$%&'()*+,\\-./:;<=>?@\\[^_{|}~",k.em=h(k.em).replace(/punctuation/g,k._punctuation).getRegex(),k._escapes=/\\([!"#$%&'()*+,\-.\/:;<=>?@\[\]\\^_`{|}~])/g,k._scheme=/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/,k._email=/[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/,k.autolink=h(k.autolink).replace("scheme",k._scheme).replace("email",k._email).getRegex(),k._attribute=/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/,k.tag=h(k.tag).replace("comment",v._comment).replace("attribute",k._attribute).getRegex(),k._label=/(?:\[[^\[\]]*\]|\\[\[\]]?|`[^`]*`|[^\[\]\\])*?/,k._href=/\s*(<(?:\\[<>]?|[^\s<>\\])*>|[^\s\x00-\x1f]*)/,k._title=/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/,k.link=h(k.link).replace("label",k._label).replace("href",k._href).replace("title",k._title).getRegex(),k.reflink=h(k.reflink).replace("label",k._label).getRegex(),k.normal=f({},k),k.pedantic=f({},k.normal,{strong:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,em:/^_(?=\S)([\s\S]*?\S)_(?!_)|^\*(?=\S)([\s\S]*?\S)\*(?!\*)/,link:h(/^!?\[(label)\]\((.*?)\)/).replace("label",k._label).getRegex(),reflink:h(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",k._label).getRegex()}),k.gfm=f({},k.normal,{escape:h(k.escape).replace("])","~|])").getRegex(),_extended_email:/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/,url:/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,_backpedal:/(?:[^?!.,:;*_~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_~)]+(?!$))+/,del:/^~+(?=\S)([\s\S]*?\S)~+/,text:h(k.text).replace("]|","~]|").replace("|$","|https?://|ftp://|www\\.|[a-zA-Z0-9.!#$%&'*+/=?^_`{\\|}~-]+@|$").getRegex()}),k.gfm.url=h(k.gfm.url,"i").replace("email",k.gfm._extended_email).getRegex(),k.breaks=f({},k.gfm,{br:h(k.br).replace("{2,}","*").getRegex(),text:h(k.gfm.text).replace("{2,}","*").getRegex()}),i.rules=k,i.output=function(t,e,n){return new i(e,n).output(t)},i.prototype.output=function(t){for(var e,n,r,s,a,o,c="";t;)if(a=this.rules.escape.exec(t))t=t.substring(a[0].length),c+=l(a[1]);else if(a=this.rules.tag.exec(t))!this.inLink&&/^<a /i.test(a[0])?this.inLink=!0:this.inLink&&/^<\/a>/i.test(a[0])&&(this.inLink=!1),!this.inRawBlock&&/^<(pre|code|kbd|script)(\s|>)/i.test(a[0])?this.inRawBlock=!0:this.inRawBlock&&/^<\/(pre|code|kbd|script)(\s|>)/i.test(a[0])&&(this.inRawBlock=!1),t=t.substring(a[0].length),c+=this.options.sanitize?this.options.sanitizer?this.options.sanitizer(a[0]):l(a[0]):a[0];else if(a=this.rules.link.exec(t)){var h=b(a[2],"()");if(h>-1){var u=a[2].length-h;a[2]=a[2].substring(0,h),a[0]=a[0].substring(0,a[0].length-u)}t=t.substring(a[0].length),this.inLink=!0,r=a[2],this.options.pedantic?(e=/^([^'"]*[^\s])\s+(['"])(.*)\2/.exec(r))?(r=e[1],s=e[3]):s="":s=a[3]?a[3].slice(1,-1):"",r=r.trim().replace(/^<([\s\S]*)>$/,"$1"),c+=this.outputLink(a,{href:i.escapes(r),title:i.escapes(s)}),this.inLink=!1}else if((a=this.rules.reflink.exec(t))||(a=this.rules.nolink.exec(t))){if(t=t.substring(a[0].length),e=(a[2]||a[1]).replace(/\s+/g," "),!(e=this.links[e.toLowerCase()])||!e.href){c+=a[0].charAt(0),t=a[0].substring(1)+t;continue}this.inLink=!0,c+=this.outputLink(a,e),this.inLink=!1}else if(a=this.rules.strong.exec(t))t=t.substring(a[0].length),c+=this.renderer.strong(this.output(a[4]||a[3]||a[2]||a[1]));else if(a=this.rules.em.exec(t))t=t.substring(a[0].length),c+=this.renderer.em(this.output(a[6]||a[5]||a[4]||a[3]||a[2]||a[1]));else if(a=this.rules.code.exec(t))t=t.substring(a[0].length),c+=this.renderer.codespan(l(a[2].trim(),!0));else if(a=this.rules.br.exec(t))t=t.substring(a[0].length),c+=this.renderer.br();else if(a=this.rules.del.exec(t))t=t.substring(a[0].length),c+=this.renderer.del(this.output(a[1]));else if(a=this.rules.autolink.exec(t))t=t.substring(a[0].length),r="@"===a[2]?"mailto:"+(n=l(this.mangle(a[1]))):n=l(a[1]),c+=this.renderer.link(r,null,n);else if(this.inLink||!(a=this.rules.url.exec(t))){if(a=this.rules.text.exec(t))t=t.substring(a[0].length),this.inRawBlock?c+=this.renderer.text(a[0]):c+=this.renderer.text(l(this.smartypants(a[0])));else if(t)throw new Error("Infinite loop on byte: "+t.charCodeAt(0))}else{if("@"===a[2])r="mailto:"+(n=l(a[0]));else{do{o=a[0],a[0]=this.rules._backpedal.exec(a[0])[0]}while(o!==a[0]);n=l(a[0]),r="www."===a[1]?"http://"+n:n}t=t.substring(a[0].length),c+=this.renderer.link(r,null,n)}return c},i.escapes=function(t){return t?t.replace(i.rules._escapes,"$1"):t},i.prototype.outputLink=function(t,e){var n=e.href,i=e.title?l(e.title):null;return"!"!==t[0].charAt(0)?this.renderer.link(n,i,this.output(t[1])):this.renderer.image(n,i,l(t[1]))},i.prototype.smartypants=function(t){return this.options.smartypants?t.replace(/---/g,"—").replace(/--/g,"–").replace(/(^|[-\u2014\/(\[{"\s])'/g,"$1‘").replace(/'/g,"’").replace(/(^|[-\u2014\/(\[{\u2018\s])"/g,"$1“").replace(/"/g,"”").replace(/\.{3}/g,"…"):t},i.prototype.mangle=function(t){if(!this.options.mangle)return t;for(var e,n="",i=t.length,r=0;r<i;r++)e=t.charCodeAt(r),Math.random()>.5&&(e="x"+e.toString(16)),n+="&#"+e+";";return n},r.prototype.code=function(t,e,n){var i=(e||"").match(/\S*/)[0];if(this.options.highlight){var r=this.options.highlight(t,i);null!=r&&r!==t&&(n=!0,t=r)}return i?'<pre><code class="'+this.options.langPrefix+l(i,!0)+'">'+(n?t:l(t,!0))+"</code></pre>\n":"<pre><code>"+(n?t:l(t,!0))+"</code></pre>"},r.prototype.blockquote=function(t){return"<blockquote>\n"+t+"</blockquote>\n"},r.prototype.html=function(t){return t},r.prototype.heading=function(t,e,n,i){return this.options.headerIds?"<h"+e+' id="'+this.options.headerPrefix+i.slug(n)+'">'+t+"</h"+e+">\n":"<h"+e+">"+t+"</h"+e+">\n"},r.prototype.hr=function(){return this.options.xhtml?"<hr/>\n":"<hr>\n"},r.prototype.list=function(t,e,n){var i=e?"ol":"ul";return"<"+i+(e&&1!==n?' start="'+n+'"':"")+">\n"+t+"</"+i+">\n"},r.prototype.listitem=function(t){return"<li>"+t+"</li>\n"},r.prototype.checkbox=function(t){return"<input "+(t?'checked="" ':"")+'disabled="" type="checkbox"'+(this.options.xhtml?" /":"")+"> "},r.prototype.paragraph=function(t){return"<p>"+t+"</p>\n"},r.prototype.table=function(t,e){return e&&(e="<tbody>"+e+"</tbody>"),"<table>\n<thead>\n"+t+"</thead>\n"+e+"</table>\n"},r.prototype.tablerow=function(t){return"<tr>\n"+t+"</tr>\n"},r.prototype.tablecell=function(t,e){var n=e.header?"th":"td";return(e.align?"<"+n+' align="'+e.align+'">':"<"+n+">")+t+"</"+n+">\n"},r.prototype.strong=function(t){return"<strong>"+t+"</strong>"},r.prototype.em=function(t){return"<em>"+t+"</em>"},r.prototype.codespan=function(t){return"<code>"+t+"</code>"},r.prototype.br=function(){return this.options.xhtml?"<br/>":"<br>"},r.prototype.del=function(t){return"<del>"+t+"</del>"},r.prototype.link=function(t,e,n){if(null===(t=u(this.options.sanitize,this.options.baseUrl,t)))return n;var i='<a href="'+l(t)+'"';return e&&(i+=' title="'+e+'"'),i+=">"+n+"</a>"},r.prototype.image=function(t,e,n){if(null===(t=u(this.options.sanitize,this.options.baseUrl,t)))return n;var i='<img src="'+t+'" alt="'+n+'"';return e&&(i+=' title="'+e+'"'),i+=this.options.xhtml?"/>":">"},r.prototype.text=function(t){return t},s.prototype.strong=s.prototype.em=s.prototype.codespan=s.prototype.del=s.prototype.text=function(t){return t},s.prototype.link=s.prototype.image=function(t,e,n){return""+n},s.prototype.br=function(){return""},a.parse=function(t,e){return new a(e).parse(t)},a.prototype.parse=function(t){this.inline=new i(t.links,this.options),this.inlineText=new i(t.links,f({},this.options,{renderer:new s})),this.tokens=t.reverse();for(var e="";this.next();)e+=this.tok();return e},a.prototype.next=function(){return this.token=this.tokens.pop()},a.prototype.peek=function(){return this.tokens[this.tokens.length-1]||0},a.prototype.parseText=function(){for(var t=this.token.text;"text"===this.peek().type;)t+="\n"+this.next().text;return this.inline.output(t)},a.prototype.tok=function(){switch(this.token.type){case"space":return"";case"hr":return this.renderer.hr();case"heading":return this.renderer.heading(this.inline.output(this.token.text),this.token.depth,c(this.inlineText.output(this.token.text)),this.slugger);case"code":return this.renderer.code(this.token.text,this.token.lang,this.token.escaped);case"table":var t,e,n,i,r="",s="";for(n="",t=0;t<this.token.header.length;t++)n+=this.renderer.tablecell(this.inline.output(this.token.header[t]),{header:!0,align:this.token.align[t]});for(r+=this.renderer.tablerow(n),t=0;t<this.token.cells.length;t++){for(e=this.token.cells[t],n="",i=0;i<e.length;i++)n+=this.renderer.tablecell(this.inline.output(e[i]),{header:!1,align:this.token.align[i]});s+=this.renderer.tablerow(n)}return this.renderer.table(r,s);case"blockquote_start":for(s="";"blockquote_end"!==this.next().type;)s+=this.tok();return this.renderer.blockquote(s);case"list_start":s="";for(var a=this.token.ordered,o=this.token.start;"list_end"!==this.next().type;)s+=this.tok();return this.renderer.list(s,a,o);case"list_item_start":s="";var l=this.token.loose;for(this.token.task&&(s+=this.renderer.checkbox(this.token.checked));"list_item_end"!==this.next().type;)s+=l||"text"!==this.token.type?this.tok():this.parseText();return this.renderer.listitem(s);case"html":return this.renderer.html(this.token.text);case"paragraph":return this.renderer.paragraph(this.inline.output(this.token.text));case"text":return this.renderer.paragraph(this.parseText());default:var h='Token with "'+this.token.type+'" type was not found.';if(!this.options.silent)throw new Error(h);console.log(h)}},o.prototype.slug=function(t){var e=t.toLowerCase().trim().replace(/[\u2000-\u206F\u2E00-\u2E7F\\'!"#$%&()*+,.\/:;<=>?@[\]^`{|}~]/g,"").replace(/\s/g,"-");if(this.seen.hasOwnProperty(e)){var n=e;do{e=n+"-"+ ++this.seen[n]}while(this.seen.hasOwnProperty(e))}return this.seen[e]=0,e},l.escapeTest=/[&<>"']/,l.escapeReplace=/[&<>"']/g,l.replacements={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},l.escapeTestNoEncode=/[<>"']|&(?!#?\w+;)/,l.escapeReplaceNoEncode=/[<>"']|&(?!#?\w+;)/g;var x={},w=/^$|^[a-z][a-z0-9+.-]*:|^[?#]/i;d.exec=d,y.options=y.setOptions=function(t){return f(y.defaults,t),y},y.getDefaults=function(){return{baseUrl:null,breaks:!1,gfm:!0,headerIds:!0,headerPrefix:"",highlight:null,langPrefix:"language-",mangle:!0,pedantic:!1,renderer:new r,sanitize:!1,sanitizer:null,silent:!1,smartLists:!1,smartypants:!1,tables:!0,xhtml:!1}},y.defaults=y.getDefaults(),y.Parser=a,y.parser=a.parse,y.Renderer=r,y.TextRenderer=s,y.Lexer=n,y.lexer=n.lex,y.InlineLexer=i,y.inlineLexer=i.output,y.Slugger=o,y.parse=y,t.exports=y}(w||"undefined"!=typeof window&&window)}),C=function(){function t(t,e,n,r){this.element=n,this.container=e,this.settings=r,this.controller=t,this.areaContainer=null,this.previewContainer=null,this.fullscreenEnabled=!1,this.previewEnabled=!1,this.isDisabled=!1,this.elementKeyPress=i.debounce(this.elementKeyPress.bind(this),250)}return t.prototype.previewOn=function(){var e=this,n=this.settings.classes;t.elementHandlers.forEach(function(t){e.element.addEventListener(t,e.elementKeyPress)}),this.elementKeyPress(),this.previewContainer.classList.add(n.area+"--preview__active")},t.prototype.previewOff=function(){var e=this,n=this.settings.classes;t.elementHandlers.forEach(function(t){e.element.removeEventListener(t,e.elementKeyPress)}),this.previewContainer.classList.remove(n.area+"--preview__active"),this.previewContainer.innerHTML=""},t.prototype.elementKeyPress=function(){this.previewContainer.innerHTML=this.html},Object.defineProperty(t.prototype,"html",{get:function(){return _(this.text)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"text",{get:function(){return this.element.value},set:function(t){this.element.value=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"disabled",{get:function(){return this.isDisabled},set:function(t){var n=this.element,i=e.defaultClasses.container[0]+"-mode-disabled";t?(n.setAttribute("disabled","disabled"),this.controller.classList.add(i)):(n.removeAttribute("disabled"),this.controller.classList.remove(i)),this.isDisabled=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"areaElement",{get:function(){return this.element},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"enabledFullscreen",{get:function(){return this.fullscreenEnabled},set:function(t){var n=e.defaultClasses.container[0]+"-mode-fullscreen";this.fullscreenEnabled=t,this.fullscreenEnabled?this.controller.classList.add(n):this.controller.classList.remove(n)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"enabledPreview",{get:function(){return this.previewEnabled},set:function(t){this.previewEnabled=t,this.previewEnabled?this.previewOn():this.previewOff()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selection",{get:function(){var t=this.element,e=t.selectionStart,n=t.selectionEnd,i=t.value;return{value:i,slice:{start:e,end:n},selectedValue:i.slice(e,n)}},set:function(e){var n=e.focus,i=e.slice,r=e.value;if(this.element.focus(),this.element.setSelectionRange(i.start,i.end),document.queryCommandEnabled(t.insertCommand)&&document.queryCommandSupported(t.insertCommand))document.execCommand(t.insertCommand,!1,r);else{var s=this.element.value;this.element.value=s.slice(0,i.start)+r+s.slice(i.end)}this.element.setSelectionRange(n.start,n.end)},enumerable:!0,configurable:!0}),t.prototype.hasEndOfLine=function(){var e=this.selection,n=e.slice;return e.value.slice(n.start,n.end).includes(t.endOfLine)},t.prototype.addHandler=function(e){t.handlerList.push(e)},t.prototype.init=function(){var e=this,n=this.settings.classes.area[0],r=i.createElement,s=this.element.cloneNode(!0),a=Object.keys(t.areaParams);return this.areaContainer=r("div",[n+"--text"]),this.previewContainer=r("div",[n+"--preview"]),this.element.parentElement.removeChild(this.element),this.element=s,this.element.classList.add(n+"--text__element"),a.forEach(function(n){e.element.setAttribute(n,t.areaParams[n])}),this.areaContainer.appendChild(this.element),this.container.appendChild(this.areaContainer),this.container.appendChild(this.previewContainer),this.element.addEventListener("keydown",function(e){t.handlerList.forEach(function(t){var n=t.settings;if(n.hotkeyCurrent&&e[n.hotkeyCurrent.modificator]&&e.key===n.hotkeyCurrent.key)return e.preventDefault(),e.stopPropagation(),void t.callback()})}),this},t.handlerList=[],t.insertCommand="insertText",t.endOfLine="\n",t.areaParams={autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false"},t.elementHandlers=["keydown","paste"],t}(),T=function(){function t(t,e){this.element=t,this.settings=e,this.container=null,this.input=null,this.layout={area:null,controls:null,params:null}}return t.prototype.collectSettings=function(){var t=this,n=Object.assign(e.defaultParams,this.settings&&this.settings.params?this.settings.params:{}),r=i.detectOs(),s=this.settings&&this.settings.theme||e.defaultTheme,a=this.settings&&this.settings.controls||e.defaultControls,o=e.defaultClasses,l=Object.assign(e.defaultLayout,this.settings&&this.settings.layout||[]);Object.keys(this.settings&&this.settings.classes||{}).forEach(function(e){var n;(n=o[e]).push.apply(n,t.settings.classes[e])}),a.forEach(function(t){t.hotkey&&(t.hotkeyCurrent=t.hotkey[r])}),this.settings={theme:s,params:n,controls:a,classes:o,layout:l}},t.prototype.generateLayout=function(){var t=this,e=this.settings,n=e.layout,r=e.classes,s=i.createElement;this.container=i.createElement("section",this.settings.classes.container),n.forEach(function(e){t.layout[e]=s("div",r[e].slice()),t.container.appendChild(t.layout[e])}),this.element.parentElement.insertBefore(this.container,this.element)},t.prototype.generateInput=function(){this.input=new C(this.container,this.layout.area,this.element,this.settings).init(),this.element=this.input.areaElement},t.prototype.generateControls=function(){var t=this,e=i.capitalize,n=this.settings.controls;n.length&&this.layout.controls&&n.forEach(function(n){var r=e(n.control);k[r]&&k[r]instanceof Function?new k[r](t.layout.controls,n,t.input).init():i.log("Button is not exists",r)})},t.prototype.generateParams=function(){var t=this,e=i.capitalize,n=this.settings.params,r=Object.keys(n);r.length&&this.layout.params&&r.forEach(function(i){var r,s=e(i),a=(r={},r[i]=n[i],r);x[s]&&x[s]instanceof Function&&new x[s](t.input,t.layout.params,a).init()})},Object.defineProperty(t.prototype,"html",{get:function(){return this.input.html},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"text",{get:function(){return this.input.text},set:function(t){this.input.text=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"disabled",{get:function(){return this.input.disabled},set:function(t){this.input.disabled=t},enumerable:!0,configurable:!0}),t.prototype.init=function(){return this.collectSettings(),this.generateLayout(),this.generateInput(),this.generateParams(),this.generateControls(),this},t}();return function(){function t(t,e){this.settings=e,this.element=t,this.controller=null}return Object.defineProperty(t.prototype,"text",{get:function(){return this.controller.text},set:function(t){this.controller.text=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"html",{get:function(){return this.controller.html},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"disabled",{get:function(){return this.controller.disabled},set:function(t){"boolean"==typeof t?this.controller.disabled=t:i.log("Disabling status should be boolean")},enumerable:!0,configurable:!0}),t.prototype.init=function(){return!this.element||this.element&&this.element.tagName&&"textarea"!==this.element.tagName.toLowerCase()?(i.log("Passed 'Element' is not a Textarea element"),null):(this.controller||(this.controller=new T(this.element,this.settings).init(),delete this.element),this)},t}()}();
